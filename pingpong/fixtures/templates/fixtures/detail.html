{% load my_tags %}

<html>
<head>
<style>
.spin {
  width: 30px;
  height: 20px;
}
</style>
</head>

<body>
  <strong>{{ league.league_name }}</strong>
  <a href="{% url 'league:index' %}">戻る</a>
  <form action="POST" method=""> <!-- データベースに反映するためのviewを適当に書くべし -->
  <table border="1">
    <tr><th></th>
      {% for p in players %}
      <th>{{ p.p_name }}</th>
      {% endfor %}
      <th>勝ち</th><th>負け</th><th>セット獲得率</th><th>得点獲得率</th><th>順位</th>
    </tr>
    <tbody>
      {% for rp in players %} <!-- row player -->
      <tr>
        <th>{{ rp.p_name }}</th>
        {% for cp in players %}  <!-- column player -->
        {% if rp.p_name == cp.p_name %}
        <td style="background-color:black"></td>
        {% else %}
        <td>
          <table rules="cols" width="100px" height="100px">
            <tr align="center">
              {% for item in mixedls %}
              {% with A=item.0.0.0 B=item.0.1.0 Aset=item.0.0.1 Bset=item.0.1.1 %}
              {% with Agains=item.1.0 Bgains=item.1.1 ABgains=item.1 isAwin=item.2 %}

              {% if A == rp and B == cp %}
              {% if isAwin and Aset >= 3 or isAwin and Bset >= 3 %} <!-- 黄色くする処理 -->
              <td colspan=5 style="background-color:yellow;">{{ Aset }}</td>
              <td style="background-color:yellow;">
                {% else %}
                <td colspan=5>{{ Aset }}</td>
                <td>
                  {% endif %}
                  {% for ag, bg in ABgains|myzip %}  <!-- ユーザ定義filter-->
                  {% if ag == 0 and bg == 0 %}
                  {% if Aset < 3 and Bset < 3 %}
                  <span class="gamecell">
                    <input class="spin" type="number" size="2"> - <input class="spin" type="number" size="2">
                  </span>
                  {% endif %}
                  {% else %}
                  <span class="gamecell">{{ ag }} - {{ bg }}</span> <br>
                  {% endif %}
                  {% endfor %}
                </td>
                {% if isAwin and Aset >= 3 or isAwin and Bset >= 3 %}
                <td colspan=5 style="background-color:yellow;">{{ Bset }}</td>
                {% else %}
                <td colspan=5>{{ Bset }}</td>
                {% endif %}

                {% elif A == cp and B == rp %}
                {% if not isAwin and Aset >= 3 or not isAwin and Bset >= 3%}
                <td colspan=5 style="background-color:yellow;">{{ Bset }}</td>
                <td style="background-color:yellow;">
                  {% else %}
                  <td colspan=5>{{ Bset }}</td>
                  <td>
                    {% endif %}
                    {% for bg, ag in ABgains|myzip %}
                    {% if ag == 0 and bg == 0 %}
                    {% if Aset < 3 and Bset < 3 %}
                    <span class="gamecell">
                      <input class="spin" type="number" size="2"> - <input class="spin" type="number" size="2">
                    </span>
                    {% endif %}
                    {% else %}
                    <span class="gamecell">{{ ag }} - {{ bg }}</span> <br>
                    {% endif %}
                    {% endfor %}
                  </td>
                  {% if not isAwin and Aset >= 3 or not isAwin and Bset >= 3%}
                  <td colspan=5 style="background-color:yellow;">{{ Aset }}</td>
                  {% else %}
                  <td colspan=5>{{ Aset }}</td>
                  {% endif %}

                  {% endif %}
                  {% endwith %}{% endwith %}
                  {% endfor %}
                </tr>
              </table>
            </td>
            {% endif %}
            {% endfor %}
            <td align="center">{{ rp.win_num }}</td>
            <td align="center">{{ rp.lose_num }}</td>
            <td align="center">{{ rp.set_rate|floatformat:"-2" }}</td>  <!-- 小数点第二位まで -->
            <td align="center">{{ rp.points_rate|floatformat:"-2" }}</td>
            <td>1</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      <input type="submit" name="updatedb" value="反映する">
    </form>
  </body>
  </html>
